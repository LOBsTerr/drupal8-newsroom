id: newsroom_item_translations
label: Newsroom images translations.
migration_group: newsroom
#deriver: 'Drupal\newsroom_connector_item\Plugin\migrate\NewsroomItemImageLanguageDeriver'
migration_tags:
  - newsroom_item

source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: simple_xml
  urls: 'http://lobsterr.me/item.xml'

  item_selector: '//channel/item'

  ids:
    item_id:
      type: integer

  fields:
    -
      name: item_id
      label: 'Item ID'
      selector: 'infsonewsroom:BasicId/text()'
    -
      name: image
      label: 'Image'
      selector: 'enclosure[@type="image/jpeg" and @schema="Public"]/@url'
    -
      name: image_title
      label: 'Image title'
      selector: 'infsonewsroom:PicTitle[@lang="EN"]/text()'
    -
      name: image_title_fr
      label: 'Image title FR'
      selector: 'infsonewsroom:PicTitle[@lang="FR"]/text()'
  constants:
    file_dest_uri: 'public://newsroom/items'

destination:
  plugin: 'entity:file'

process:
  file_name:
    - plugin: callback
      callable: basename
      source: image

  file_dest:
    -
      plugin: concat
      delimiter: /
      source:
        - constants/file_dest_uri
        - '@file_name'
    -
      plugin: urlencode

  filename: image_title

  uri:
    plugin: file_copy
    source:
      - image
      - '@file_dest'

  status:
    plugin: default_value
    default_value: 1

  langcode:
    plugin: default_value
    default_value: 1

dependencies:
  enforced:
    module:
      - newsroom_item
